package Algorithms;

import java.util.ArrayList;

import org.apache.commons.math3.linear.MatrixUtils;
import org.apache.commons.math3.linear.RealMatrix;

import utils.LinearSeparator;

public class Perceptron {
	
	public static LinearSeparator train(RealMatrix featureMatrix, ArrayList<String> labels) {
		int rows = featureMatrix.getRowDimension();
		System.out.println(rows);
		RealMatrix theta = MatrixUtils.createRealMatrix(1, rows);
		double theta_0 = 0;
		System.out.println(theta);
		int counter = 0;
		boolean misclassification = true;
		
		while (misclassification && counter < 5000) {
			misclassification = false;
			counter ++;
			for (int i=0; i<rows; i++) {				
				int label = Integer.parseInt(labels.get(i));
				System.out.println(i);
				RealMatrix featureVector = featureMatrix.getRowMatrix(i);
				System.out.println("   LABEL: " + label);
				double loss = featureVector.multiply(featureVector.transpose()).getEntry(0, 0) + theta_0;
				System.out.println("   LOSS: " + loss);
				System.out.println("   COND: " + label * loss);
				if (label * loss <= 0) {
					System.out.println("   COND: true");
					RealMatrix offset = featureVector.scalarMultiply((double) label);
					System.out.println("   OFFSET: done");
					theta = theta.add(offset);
					System.out.println("   THETA: done");
					theta_0 += label;
					System.out.println("   New T_0: " + theta_0);
					misclassification = true;
				}
			}
		}
		System.out.println("hihi");
		LinearSeparator separator = new LinearSeparator(theta, theta_0);
		return separator;		
	}

}
